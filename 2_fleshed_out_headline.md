# これからRailsを学ぶ方へ
初めまして、ここではRubyのWEBアプリケーションフレームワークである
`Ruby on Rails`について解説していきたいと思います！

`HTML/CSS`、`javascript`、さらに`Ruby`について多くのことを学び、身につけてきたあなたがさらなるスキルアップを望むのであれば、今が`Ruby on Rails`を学ぶ時です！

さぁ、一緒に`Ruby on Rails`について学んで行きましょう！

## この記事のゴール
さて、先ほど一緒に`Ruby on Rails`について学んで行きましょうと言いましたが、いきなり全てを学ぼうとするとインプットが多すぎて頭が混乱してしまいます。

この記事では、`Ruby on Rails`がそもそもどんなもので、どのようなことができるのかなどの概要を学んで行きましょう！
概要を押さえておくことは、学習を始めるにあたってとても重要なことです。

またこの記事では、既にネットにある情報を分かりやすい形に噛み砕いていくような流れで説明して行きたいと思います。

この記事を読み終わる頃には、本格的に`Ruby on Rails`を学ぶ準備が整っていると思います。

それでは始めて行きましょう！

## Ruby on Railsとは
`Ruby on Rails`とは何でしょうか？
[Rails Guide](https://railsguides.jp/getting_started.html)によると、
> Rubyプログラミング言語で書かれたWebアプリケーションフレームワークです。 Railsは、あらゆる開発者がWebアプリケーションの開発を始めるうえで必要となる作業やリソースを事前に仮定して準備しておくことで、Webアプリケーションをより簡単にプログラミングできるように設計されています。

とあります。

フレームワークとは、ある領域のシステム開発を容易にするための雛形のことです。つまり`WEBアプリケーションフレームワーク`とはWEBアプリケーション開発を効率的に進められるように設計された雛形のことですね。

つまり`Ruby on Rails`はWEBアプリケーションフレームワークの一つです。

多くのフレームワークには哲学というものがあります。
Railsの場合以下のような哲学が掲げられています
- 同じことを繰り返すな (Don't Repeat Yourself: DRY)
  - 同じような処理の記述を繰り返し書くと保守や拡張をしにくくなるということですね。同じような記述はまとめておきましょうという事を言っています。
- 設定より規約が優先される (Convention Over Configuration)
  - WEBアプリケーションが求める機能を実装する最善の方法はRailsが用意してくれているおかげで細かい設定はしなくても、Railsの書き方に従って書けば最低限の機能を提供してくれるという事を言っています。

上記の二つの哲学に従ったコードを書ければ、Railsは効率的な開発する上で大きな利益をもたらしてくれます。

まとめると、Ruby on Railsは`Rails流`の書き方をすれば、とても効率的な開発を行うことができるWEBアプリケーションフレームワークであるということです。


## Ruby on Railsの仕組み
Railsは`MVCアーキテクチャ`というものを採用しています。
MVCとはそれぞれモデル(Model)、ビュー(View)、コントローラ(Controller)の頭文字をとった言葉です。

分かりやすくするために、図書館の本の貸し出し管理を行うWEBアプリケーションを作ろうとしていると仮定します。

### モデル(Model)
データを扱う部分のことです。
今回の例でいうと、本や、図書館を利用するユーザーがこれに当ります。

本の貸し出し管理アプリケーションでは、誰が、どの本を借りたかという情報が不可欠です。そのような情報をDBから取得してきて扱いやすくする役割を担うのがModelです。

### ビュー(View)
ユーザーに結果を出力したり、ユーザーの要求をControllerに伝える画面の部分です。
今回の例では、もしユーザーが貸し出し中の本一覧を知りたい時に自分の要求をこのViewからControllerに対して実行します。
ユーザーとアプリケーションのやり取りを仲介する役割を担っているのがViewです。

### コントローラー(Controller)
ユーザーの要求に基づいて、必要なモデルを持ってきてViewと組み合わせて結果を返す役割を担っています。アプリケーションを作っていくと、たくさんのコントローラが作られていくでしょう。
もし、ユーザーから貸し出し中の本を表示する要求がきたら、モデルから該当するデータを集めて、表示すべきViewと組み合わせてユーザーに表示します。

### ルーター
ルーターはMVCの頭文字には含まれていませんが、重要な要素の一つです。
ルーターはユーザーがアクセスしたURIに基づいて、処理するべきコントローラにリクエストされたデータを渡す役割を担っています。
ルーターがあるおかげで、適切なコントローラーに処理をしてもらう事ができるのです。

ユーザーがMVCアーキテクチャのアプリケーションを使う時の流れは以下の画像のようになっています。

[![Image from Gyazo](https://i.gyazo.com/1d3051150b1e81d4da96a1710337be8b.png)](https://gyazo.com/1d3051150b1e81d4da96a1710337be8b)

1. ユーザーのリクエストをルーターが適切なControllerに渡す
1. リクエストを受け付けたControllerは要求に応じたModelを取得してくる
1. 取得したModelと適切なViewを組み合わせて、最終的にユーザーに表示するためのViewを作成する。
1. 作成したViewをレスポンスとして、ユーザーのブラウザに表示する。

というような流れになります。
RailsはMVCアーキテクチャを採用しているのでこの処理の流れを理解しておくことはとても重要です。

## 実際にRailsアプリを作ってみよう
説明を読んだだけでは、理解するのは難しいかもしれません。
理解できた方は、ここは読み飛ばしていただいて構いません。
ここでは簡単なアプリケーションを作って理解を深めましょう。


### 準備
まずは、Railsアプリケーションを作るための準備をしていきます。
Rubyのバージョンを確認しましょう。

ターミナルで

> ``` ruby -v```

としてバージョンを確認してください。RailsではRubyのバージョンは2.2.2以上でなければいけません。もし2.2.2以下のバージョンであれば新たに2.2.2以上のRubyをインストールしましょう。

次にSQLite3がインストールされているか確認しましょう。
ターミナルで
> ```sqlite3 --version```

と入力してバージョンが確認できれば大丈夫です。多くのUNIX系OSにはSQLite3が同梱されています。
もし、バージョンが確認できなければSQLite3をインストールする必要があります。[こちら](https://www.dbonline.jp/sqlite/install/)を参考にインストールしてみてください。

Rubyのバージョン確認と、SQLite3がインストールができていればRailsアプリケーションを作る準備はできました！
始めていきましょう！


### 本を管理するアプリを作る
ここでは、RailsのScaffoldという機能を使って簡単な本を管理するアプリケーションを作りましょう。
Scaffoldを使えば、Model、Controller、Viewなどの雛形を自動で生成してくれます。とりあえずRailsの仕組みを理解するのには、もってこいの機能です。


まずは、適当なディレクトリを作ってそこでscaffoldを試してみましょう！
```
>> mkdir sample
>> cd sample
```

次のコマンドでRailsアプリを作り始めることができます！今回はscaffold_bookという名前のアプリケーションを作ってみました！
```
>> rails new scaffold_book
```
その後、scaffold_bookのディレクトリに移動します。
```
>> cd scaffold_book
```

ここまでで、アプリケーションの基礎は完成しています！
現在アプリケーションがちゃんと動作しているか確認してみましょう！
```
>> rails server
```
以下のような画面が表示されていれば、正常に動作しています！

[![Image from Gyazo](https://i.gyazo.com/8503abe0be50db20ba99d08167e94942.png)](https://gyazo.com/8503abe0be50db20ba99d08167e94942)


ここから、Scaffoldのすごい機能を試していきましょう！
次のコマンドを試してみましょう。
```
>> rails generate scaffold Book name:string author:string isbn:string
```
Controller、ViewやModelを含む様々なファイルやディレクリが作成されました。他にもmigrationファイルというものが作成されています。
このmigrationはデータベーススキーマの変更などを簡単に行うための便利な手法です。アプリを開発していく過程でデータベースのテーブルの構造を変更したり、作成することが多くなっていきます。その際に活躍するのがmigrationファイルです。

db/migrate/20160310025746_create_users.rb
というのがマイグレーションファイルです。

今はmigrationファイルを作成しただけで、DBのテーブルを作成して、モデルと連携させるにはmigrationファイルの内容をDBに反映しなくてはなりません。
モデルはDBと密接に関わっており、DBとテーブルがなくてはモデルは機能しません。

まずは以下のコマンドでマイグレーションファイルの内容をDBに反映させましょう
。
```
>> rails db:migrate
```

ここまでで、今回作成するアプリは全て完成しました！
[http://localhost:3000/books](http://localhost:3000/books/)にアクセスしてみてください！
ここから、bookの追加、編集、削除できます！いろいろ動かしてみてください！

### 解説
bookの一覧、追加、編集のページでそれぞれURIが違うのにお気づきでしょうか？
このURIの違いは、ユーザーのリクエストを処理するコントローラーのアクションの違いを意味しています。
アクションとはControllerに記述されているメソッドのことです。
例えば、
```
http://localhost:3000/books/new
```
というURIはbookを新規作成する時のものですが、これはBooksControllerのnewアクションを実行した時の結果の表示をしています。

次に
```
http://localhost:3000/books/[id]/new
```
というURIはbookを編集する時のものですが、これはBooksControllerのeditアクションを実行した時の結果の表示をしています。
先ほどと違い、[id]という記述がありますが、これはDBに保存されている[id]番目のbookを編集するという意味です。

削除するときなども実は削除用のURIにアクセスしています。
上記のようなルーティングは
```
>> rails routes
```
というコマンドで確認できます。
さて、今までのことをまとめるとユーザーがアクセスしたURIに応じて、処理するコントローラーやアクションが選ばれて、そのアクション内の処理が実行されます。アクション内には、モデルを取得したりビューを作成する関数を書いたりします。
これがRailsにおける処理の流れです。

しかし、books_controller.rbにはアクション内に何も記述していないアクションもあります。
このアクションでは何もしていないのか？と思うかもしれないですが、そうではありません。
実はRailsが自動的に操作するモデルを取得したりビューを作成してくれています。なぜこのように自動的にやってくれるのでしょうか？


それはRailsの哲学である
> 設定より規約が優先される (Convention Over Configuration)

が関係しています。実はコントローラーのファイル名などから取得してくるモデルを判断したり、作成するビューのファイルを判断してくれています。
この哲学により、コードを書く量を減らしているのです。


逆に規約に乗っ取っていない書き方をするとRailsが自動で判断できなくなり、思わぬエラーを引き起こします。注意してください。

## まとめ
いかがでしたでしょうか？

`Ruby on Rails`はRubyで書かれたWEBアプリケーションフレームワークという事でした。
MVCアーキテクチャを採用し、さらに

> 同じことを繰り返すな (Don't Repeat Yourself: DRY)

> 設定より規約が優先される (Convention Over Configuration)

という2つの哲学のもとに開発されたWEBアプリケーションで、とても効率的な開発ができるように工夫されています。
世界中で多くの企業が採用しているのも頷けますね。


Railsの概要を把握できて、本格的に学んでいくための足がかりになったと思ってくれたら幸いです。
これからも頑張っていきましょう！
